<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>CashChop - Dashboard</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <h1>Welcome to CashChop Dashboard</h1>

    <button id="logout-btn">Logout</button>

    <h2>CPX Research Surveys</h2>
    <!-- CPX Research Iframe -->
    <iframe src="https://cpx-research.com?yourID=userId" width="100%" height="600px" style="border:none;"></iframe>

    <h2>Top Up Your Wallet</h2>
    <button id="paystack-btn">Pay Now</button>

    <h2>Adsterra Ads</h2>
    <script type='text/javascript' src='//pl16213274.profitableratecpm.com/97/df/7b/97df7bff03132071f1f31973f5ddc233.js'></script>
  </div>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCThCejvaE5K7rUwwMcQZYeuGd7rkhqhmQ",
      authDomain: "cashchop-aa33e.firebaseapp.com",
      projectId: "cashchop-aa33e",
      storageBucket: "cashchop-aa33e.firebasestorage.app",
      messagingSenderId: "977465105616",
      appId: "1:977465105616:web:f8dcd659d244c1b5dd52d5",
      measurementId: "G-R471K682RM"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth();

    // Check if user is logged in
    onAuthStateChanged(auth, (user) => {
      if (!user) {
        window.location.href = "index.html"; // Not logged in
      }
    });

    // Handle Logout
    const logoutBtn = document.getElementById('logout-btn');
    logoutBtn.addEventListener('click', () => {
      signOut(auth).then(() => {
        window.location.href = "index.html";
      }).catch((error) => {
        alert('Logout Error: ' + error.message);
      });
    });

    // Paystack Payment
    const paystackBtn = document.getElementById('paystack-btn');
    paystackBtn.addEventListener('click', () => {
      var handler = PaystackPop.setup({
        key: 'pk_live_b5fa4e730d9baa38f7ff012ad4d263d5d3459c5b',
        email: auth.currentUser.email,
        amount: 500 * 100, // Example amount: 500 Naira
        currency: 'NGN',
        callback: function(response){
          alert('Payment complete! Reference: ' + response.reference);
        },
        onClose: function(){
          alert('Transaction canceled');
        }
      });
      handler.openIframe();
    });
  </script>

  <!-- Paystack JS -->
  <script src="https://js.paystack.co/v1/inline.js"></script>
</body>
</html>
